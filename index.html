<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DMS â€“ Hub Nazionale del Commercio</title>
  <link rel="stylesheet" href="assets/style.css"/>
</head>
<body>
  <div class="container">
    <div class="hero card">
      <div>
        <h1>DMS â€“ Hub Nazionale del Commercio</h1>
        <p>Minisito pronto per pubblicazione (GitHub Pages). Include link al cruscotto e materiali.</p>
      </div>
      <div>
        <a href="https://chcndr.github.io/dms-site/" target="_blank" id="openDash" class="btn">Apri Cruscotto DMS</a>
        <a href="contabilita.html" class="btn">ContabilitÃ  DMS</a>
        <a href="?admin=true" class="btn alt">Admin</a>
      </div>
    </div>

    <div class="grid">
      <section class="card">
        <h3 class="section-title">Anteprima <span class="badge">Video</span></h3>
        <div class="video-box" id="previewBox">
          <small class="muted">Aggiungi un file in <code>/site/assets/preview.jpg</code> oppure un video in <code>/site/videos/</code></small>
        </div>
        <div class="hr"></div>
        <p><small class="muted">Suggerimento: per file .MOV pesanti, usa n8n presigned URL o host esterno.</small></p>
      </section>

      <section class="card">
        <h3 class="section-title">Documenti <span class="badge">PDF</span></h3>
        <ul class="list" id="pdfList">
          <!-- Link diretti ai PDF su GitHub Pages -->
          <li><a href="https://chcndr.github.io/dms-site/docs/DMS_E_CLUST-ER.pdf" target="_blank">ðŸ“„ DMS e CLUST-ER (PDF)</a></li>
          <li><a href="https://chcndr.github.io/dms-site/docs/PRESENTAZIONE_DMS.pdf" target="_blank">ðŸ“„ Presentazione DMS (PDF)</a></li>
        </ul>
      </section>

      <section class="card">
        <h3 class="section-title">Video <span class="badge">Media</span></h3>
        <ul class="list" id="videoList">
          <!-- Link diretti ai video su GitHub Pages -->
          <li>
            <video controls style="width:100%; max-width:480px; margin:8px 0">
              <source src="https://chcndr.github.io/dms-site/videos/HUB_DMS_compressed.MOV" type="video/quicktime">
              ðŸŽ¥ Hub DMS (video non supportato)
            </video>
          </li>
          <li>
            <video controls style="width:100%; max-width:480px; margin:8px 0">
              <source src="https://chcndr.github.io/dms-site/site/videos/Il%20mio%20filmato%2023.MOV" type="video/quicktime">
              ðŸŽ¥ Il mio filmato 23 (video non supportato)
            </video>
          </li>
        </ul>
      </section>
    </div>

    <section id="admin" class="card" style="margin-top:18px; display:none">
      <h3>Admin</h3>
      <p><small class="muted">Sezione visibile quando l'URL contiene <code>?admin=true</code>. Prevede collegamento a n8n per presigned upload e registrazione contenuti.</small></p>
      
      <!-- Sezione ContabilitÃ  DMS -->
      <div class="card" style="margin: 16px 0; padding: 16px; border: 1px solid #e6e6e6; border-radius: 8px;">
        <h4>ContabilitÃ  DMS</h4>
        <p>Gestisci contabilitÃ , fatture, scadenze e report direttamente dal tuo cruscotto DMS.</p>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 12px;">
          <a class="btn" href="https://dms-ai.app.n8n.cloud/webhook/contabilita/onboard?plan=trial30&src=admin">Attiva prova 30 giorni</a>
          <a class="btn alt" href="https://contabilita.dominio.provvisorio/?from=admin">Apri Dashboard</a>
        </div>
        <p style="margin-top: 8px; color: #777; font-size: 12px;">Accesso riservato agli utenti registrati. Per assistenza contattaci.</p>
      </div>
      
      <ul class="list">
        <li>Upload via n8n (presigned URL + register)</li>
        <li>Upload diretto su GitHub (Contents API, PAT)</li>
        <li>Aggiornamento <code>content/manifest.json</code></li>
      </ul>
    </section>

    <p class="footer">Â© 2025 DMS â€“ Digital Market System</p>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const isAdmin = params.get('admin') === 'true';
    if (isAdmin) document.getElementById('admin').style.display = 'block';

    const DASH_URL = params.get('dash') || '#'; // sostituito da Manus con URL reale
    document.getElementById('openDash').setAttribute('href', DASH_URL);

    fetch('content/manifest.json')
      .then(r => r.json())
      .then(data => {{ render(data); }})
      .catch(() => {{ render({{pdfs:[],videos:[]}}); }});

    function render(data){{
      const pdfList = document.getElementById('pdfList');
      const videoList = document.getElementById('videoList');
      const makeItem = (t,u)=>`<li><a class="btn alt" href="${u}" download>${t}</a></li>`;

      if(data.pdfs?.length){{
        pdfList.innerHTML = data.pdfs.map(x=>makeItem(x.title||x.file, x.url||( 'docs/' + x.file ))).join('');
      }} else {{
        pdfList.innerHTML = '<li><small class="muted">Nessun PDF registrato.</small></li>';
      }}

      if(data.videos?.length){{
        videoList.innerHTML = data.videos.map(x=>makeItem(x.title||x.file, x.url||( 'videos/' + x.file ))).join('');
      }} else {{
        videoList.innerHTML = '<li><small class="muted">Nessun video registrato.</small></li>';
      }}
    }}
  </script>

  <script>
    (() => {
      const p = new URL(location).searchParams;
      const base = p.get('base') || localStorage.getItem('base') || 'https://dms-ai.app.n8n.cloud';
      const token = p.get('token') || localStorage.getItem('token') || '';
      localStorage.setItem('base', base);
      if (token) localStorage.setItem('token', token);
      const $b = document.getElementById('base'); if ($b) $b.value = base;
      const $t = document.getElementById('token'); if ($t && token) $t.value = token;
    })();
  </script>
</body>
</html>
